<!doctype html>
<html lang="es" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IvaAsins — Documentación</title>
  <style>
    :root {
      --font-body: "Avenir Next", "Avenir", "Nunito", "Trebuchet MS", sans-serif;
      --font-head: "Iowan Old Style", "Charter", "Palatino Linotype", "Book Antiqua", serif;
      --radius: 14px;
      --shadow: 0 10px 30px rgba(12, 18, 28, 0.12);
      --shadow-soft: 0 6px 18px rgba(12, 18, 28, 0.08);
    }

    html[data-theme="light"] {
      --bg: #f3f5f7;
      --bg-accent: #eef2f7;
      --text: #1f2937;
      --muted: #5f6b7a;
      --card: #ffffff;
      --border: #e5e7eb;
      --primary: #0f766e;
      --primary-contrast: #ffffff;
      --secondary: #1d4ed8;
      --code-bg: #f7f7f9;
      --chip: #e7f1f0;
      --link: #0f766e;
    }

    html[data-theme="dark"] {
      --bg: #0c1118;
      --bg-accent: #0f1520;
      --text: #e5e7eb;
      --muted: #9aa5b1;
      --card: #121a24;
      --border: #1f2937;
      --primary: #2dd4bf;
      --primary-contrast: #0b1220;
      --secondary: #60a5fa;
      --code-bg: #0d131d;
      --chip: #102024;
      --link: #5eead4;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: var(--font-body);
      color: var(--text);
      background: radial-gradient(1200px 700px at 10% -10%, var(--bg-accent), transparent 65%),
                  radial-gradient(800px 500px at 110% 10%, rgba(15, 118, 110, 0.15), transparent 60%),
                  var(--bg);
      min-height: 100vh;
    }

    a { color: var(--link); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .container {
      width: min(1100px, 92vw);
      margin: 0 auto;
      padding: 32px 0 72px;
    }

    header {
      display: flex;
      flex-direction: column;
      gap: 18px;
      padding: 20px 0 12px;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 700;
      letter-spacing: 0.2px;
    }

    .brand .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--primary);
      box-shadow: 0 0 0 6px rgba(45, 212, 191, 0.15);
    }

    .hero {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 24px;
      align-items: center;
      padding: 28px;
      background: linear-gradient(135deg, rgba(15, 118, 110, 0.1), transparent 60%);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
    }

    .hero h1 {
      font-family: var(--font-head);
      font-size: clamp(28px, 3.2vw, 40px);
      margin: 0 0 8px;
    }

    .hero p {
      margin: 0 0 16px;
      color: var(--muted);
      line-height: 1.6;
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .btn {
      padding: 12px 18px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: transform 0.15s ease, box-shadow 0.2s ease, background 0.2s ease;
      background: var(--card);
      color: var(--text);
      box-shadow: var(--shadow-soft);
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow);
    }

    .btn.primary {
      background: var(--primary);
      color: var(--primary-contrast);
      border-color: transparent;
    }

    .btn.secondary {
      background: transparent;
      color: var(--text);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: var(--chip);
      border-radius: 999px;
      font-size: 13px;
      color: var(--muted);
      border: 1px solid var(--border);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 26px;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 22px;
      box-shadow: var(--shadow-soft);
    }

    .card h2 {
      font-family: var(--font-head);
      margin: 0 0 8px;
    }

    .card p {
      margin: 0;
      color: var(--muted);
      line-height: 1.6;
    }

    .doc-section {
      margin-top: 30px;
    }

    .doc-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
    }

    .doc-content {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 26px;
      box-shadow: var(--shadow-soft);
      line-height: 1.65;
    }

    .md h1, .md h2, .md h3 {
      font-family: var(--font-head);
      margin-top: 24px;
      margin-bottom: 10px;
    }

    .md h1 { font-size: 26px; }
    .md h2 { font-size: 22px; }
    .md h3 { font-size: 18px; }

    .md p { margin: 0 0 12px; }

    .md ul, .md ol {
      margin: 0 0 12px 20px;
      padding: 0;
    }

    .md code {
      background: var(--code-bg);
      padding: 2px 6px;
      border-radius: 6px;
      font-size: 0.95em;
    }

    .md pre {
      background: var(--code-bg);
      padding: 14px;
      border-radius: 10px;
      overflow-x: auto;
      border: 1px solid var(--border);
    }

    .md hr {
      border: none;
      border-top: 1px solid var(--border);
      margin: 20px 0;
    }

    .footer {
      margin-top: 40px;
      color: var(--muted);
      font-size: 13px;
      text-align: center;
    }

    @media (max-width: 700px) {
      .hero { padding: 20px; }
      .doc-content { padding: 18px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="topbar">
        <div class="brand">
          <span class="dot"></span>
          <span>IvaAsins</span>
        </div>
        <button id="themeToggle" class="btn secondary" type="button">Modo oscuro</button>
      </div>

      <section class="hero">
        <div>
          <h1>Documentación oficial y manual de usuario</h1>
          <p>
            Centraliza la guía técnica y el manual operativo de IvaAsins. Aquí encontrarás
            el flujo completo de uso, reglas de negocio y la configuración recomendada.
          </p>
          <div class="actions">
            <a class="btn primary" href="IvaAsins_Installer.msi" download>
              Descargar instalador (.msi)
            </a>
            <a class="btn" href="#readme">Ver README</a>
            <a class="btn" href="#manual">Ver Manual de Usuario</a>
          </div>
        </div>
        <div>
          <div class="pill">Java Swing + WindowBuilder</div>
          <div class="pill" style="margin-top: 10px;">Motor de datos en Python</div>
          <div class="pill" style="margin-top: 10px;">Modo claro y oscuro</div>
        </div>
      </section>
    </header>

    <section class="grid">
      <div class="card">
        <h2>README</h2>
        <p>Arquitectura, estructura del proyecto, requisitos y resolución de errores comunes.</p>
      </div>
      <div class="card">
        <h2>Manual de Usuario</h2>
        <p>Guía operativa paso a paso, reglas de procesamiento y resultados esperados.</p>
      </div>
      <div class="card">
        <h2>Instalador</h2>
        <p>Descarga el paquete oficial para instalar IvaAsins en Windows.</p>
      </div>
    </section>

    <section id="readme" class="doc-section">
      <div class="doc-header">
        <h2>README</h2>
        <span class="pill">Referencia técnica</span>
      </div>
      <div class="doc-content md" id="readme-content"></div>
    </section>

    <section id="manual" class="doc-section">
      <div class="doc-header">
        <h2>Manual de Usuario</h2>
        <span class="pill">Guía operativa</span>
      </div>
      <div class="doc-content md" id="manual-content"></div>
    </section>

    <div class="footer">
      © IvaAsins — Documentación y manual de usuario.
    </div>
  </div>

  <script type="text/plain" id="readme-md">
# IvaAsins

## Descripción general
IvaAsins es una aplicación de escritorio (Java Swing + WindowBuilder) que procesa un reporte de Amazon Seller en formato `.txt` y genera un archivo CSV con las columnas `ASIN`, `SKU` e `IVA`. La lógica pesada de datos se ejecuta en motores Python (o `.exe` generados desde esos motores) y Java actúa como interfaz y orquestador.

El objetivo principal es identificar productos con IVA, excluir pedidos cancelados y exportar un archivo listo para control fiscal o inventario.

## Funcionalidad principal
- **Entrada 1:** CSV base de IVA con encabezados `ASIN;SKU;IVA;`.
- **Entrada 2:** Reporte Amazon Seller `.txt` delimitado (tab/; / ,) con columnas que incluyen `asin`, `sku`, `item-tax` y `order-status`.
- **Salida:** CSV `Asins_Taxes.csv` con los mismos encabezados y delimitador que el CSV base.

### Reglas de negocio
- Se procesan **todas** las filas del reporte cuyo `order-status` **no** esté cancelado.
- La columna `IVA` se llena con:
  - **SI** si `item-tax` tiene monto
  - **NO** si `item-tax` está vacío o es 0
- Si un ASIN aparece repetido en el mismo reporte:
  - Se **prioriza** el registro con `IVA=SI`.
  - Se muestra un **popup** informando duplicados detectados.

## Arquitectura
- **Java (Swing/WindowBuilder)**
  - UI, selección de archivos, drag & drop, vista previa y exportación.
- **Python (motor)**
  - Parsing de datos, filtros, deduplicación, generación del CSV final.

## Estructura del proyecto
```
IvaAsins/
├─ src/
│  ├─ interfaz/
│  │  └─ Principal.java
│  ├─ control/
│  │  └─ MotorIvaRunner.java
│  ├─ entidad/
│  └─ control/
├─ motores/
│  └─ FormatearIva/
│     ├─ FormatearIva.py
│     └─ FormatearIva.exe (opcional)
├─ Recursos/ (solo para pruebas locales)
└─ bin/
```

## Requisitos
- **Java 21+** (configurado en VS Code o Eclipse)
- **Python 3** si se usa `.py` directamente
- (Opcional) `.exe` del motor generado desde Python

## Motores
Java busca el motor en `motores/FormatearIva/`:
- Si existe `FormatearIva.exe`, se usa **primero**.
- Si no existe, se usa `FormatearIva.py`.

### Variables de entorno útiles
- `IVASINS_MOTORES`: ruta directa a la carpeta `motores`.
- `IVASINS_PYTHON`: comando Python alternativo (ej: `py -3`).

## Vista previa
La aplicación muestra en la tabla **las primeras 100 filas** del archivo generado para previsualización rápida. El exportado contiene **todas** las filas no canceladas.

## Exportación
La exportación genera el archivo final `Asins_Taxes.csv` en el directorio elegido por el usuario. Se puede exportar **sin previsualizar**: el motor se ejecuta y guarda directamente.

## Resolución de problemas
### “Unbound classpath container” (VS Code/Eclipse)
Configura un JDK válido (ej: JavaSE-21). En VS Code se recomienda:
```
.vscode/settings.json
{
  "java.jdt.ls.java.home": "C:\\Program Files\\Java\\jdk-21",
  "java.configuration.runtimes": [
    {
      "name": "JavaSE-21",
      "path": "C:\\Program Files\\Java\\jdk-21",
      "default": true
    }
  ]
}
```

### “No se encontró la carpeta 'motores'”
- Asegúrate de ejecutar desde la carpeta del proyecto `IvaAsins/`.
- O define `IVASINS_MOTORES` con la ruta correcta.

## Compilación rápida (CLI)
```
javac -encoding UTF-8 -d bin src\interfaz\Principal.java src\control\MotorIvaRunner.java
```

## Ejecución rápida (CLI)
```
java -cp bin interfaz.Principal
```

## Autor
Proyecto guiado y automatizado con asistencia de Codex.
  </script>

  <script type="text/plain" id="manual-md">
# Manual de Usuario — IvaAsins

## 1. Introducción
IvaAsins es una herramienta para filtrar y formatear reportes de Amazon Seller, identificando si un producto tiene IVA y exportando un CSV limpio y compatible con tu base de datos. Está diseñada para:
- Reducir errores manuales
- Mantener consistencia en el formato
- Procesar miles de filas en segundos

El programa utiliza:
- **Java Swing (UI)** para la interacción con el usuario.
- **Python (motor de datos)** para procesamiento avanzado.

---

## 2. Archivos requeridos

### 2.1 CSV Base de IVA
Archivo de referencia que debe contener los encabezados:
```
ASIN;SKU;IVA;
```
Características:
- Delimitado por `;` (punto y coma).
- Puede contener muchas filas previas.

### 2.2 Reporte Amazon Seller (.txt)
Archivo de exportación de pedidos. Normalmente contiene:
- Columnas separadas por tabulador (`\t`) o comas
- Encabezados como: `asin`, `sku`, `item-tax`, `order-status`

---

## 3. Interfaz principal
La ventana principal muestra:
- Campo para seleccionar **Base IVA (.csv)**
- Campo para seleccionar **Reporte Amazon (.txt)**
- Botones:
  - **Previsualizar**
  - **Exportar**
  - **Limpiar**
- Tabla de vista previa (muestra primeras 100 filas)
- Barra de estado

---

## 4. Flujo de uso recomendado

### Paso 1: Cargar archivos
Puedes hacerlo de dos formas:
1. **Buscar** usando el botón (abre el selector nativo del sistema).
2. **Arrastrar y soltar** el archivo sobre la ventana.

### Paso 2: Previsualizar (opcional)
Presiona **Previsualizar** para:
- Ejecutar el motor
- Ver las primeras 100 filas generadas

### Paso 3: Exportar
Presiona **Exportar** para:
- Elegir la ubicación de guardado
- Generar el archivo final `Asins_Taxes.csv`

*Nota: Exportar puede hacerse sin previsualizar.*

---

## 5. Reglas de procesamiento

### 5.1 Cancelados
Cualquier pedido cuyo `order-status` contenga “cancel” (Cancelled, Canceled, etc.) será **excluido**.

### 5.2 IVA
La columna IVA se calcula así:
- **SI** si el campo `item-tax` tiene un monto
- **NO** si está vacío o es 0

### 5.3 Duplicados de ASIN
Si el mismo ASIN aparece más de una vez:
- Se conserva el registro con `IVA=SI`
- Se notifica al usuario mediante un popup

---

## 6. Vista previa
La tabla solo muestra **100 filas** por rendimiento. El archivo exportado contiene **todas** las filas válidas.

---

## 7. Resultados esperados
El archivo exportado:
- Se llama `Asins_Taxes.csv`
- Tiene los mismos encabezados que el CSV base
- Está delimitado por `;`
- Contiene solo pedidos no cancelados

Ejemplo:
```
ASIN;SKU;IVA;
B0BKNSYRC7;AS-ABCD-4327;SI;
B081TMDLXF;aloma_084;NO;
```

---

## 8. Errores comunes y soluciones

### Error: “No se encontró la carpeta 'motores'”
Solución:
- Ejecuta el programa desde la carpeta raíz del proyecto.
- O define la variable `IVASINS_MOTORES` con la ruta correcta.

### Error: “Unbound classpath container”
Solución:
- Configura un JDK válido en tu IDE (recomendado Java 21).

---

## 9. Preguntas frecuentes (FAQ)

**¿Por qué solo veo 100 filas?**
La vista previa está limitada a 100 por rendimiento. La exportación incluye todo.

**¿Puedo exportar sin previsualizar?**
Sí. Exportar ejecuta el motor directamente.

**¿Qué pasa si hay un ASIN repetido?**
Se conserva el que tenga IVA=SI.

**¿Puedo usar motores .exe en lugar de .py?**
Sí. El programa usa primero el `.exe` si existe.

---

## 10. Contacto / Soporte
Si encuentras errores o deseas nuevas funciones, documenta:
- Captura del error
- Archivos de entrada usados (sin datos sensibles)
- Detalles del entorno (versión Java / OS)
  </script>

  <script>
    const themeToggle = document.getElementById('themeToggle');
    const storedTheme = localStorage.getItem('ivaasins-theme');
    const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const initialTheme = storedTheme || (systemPrefersDark ? 'dark' : 'light');

    document.documentElement.setAttribute('data-theme', initialTheme);
    themeToggle.textContent = initialTheme === 'dark' ? 'Modo claro' : 'Modo oscuro';

    themeToggle.addEventListener('click', () => {
      const current = document.documentElement.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('ivaasins-theme', next);
      themeToggle.textContent = next === 'dark' ? 'Modo claro' : 'Modo oscuro';
    });

    const renderMarkdown = (md) => {
      const lines = md.split(/\r?\n/);
      let html = '';
      let inCode = false;
      let listType = null;

      const escapeHtml = (text) => text
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');

      const closeList = () => {
        if (listType) {
          html += listType === 'ul' ? '</ul>' : '</ol>';
          listType = null;
        }
      };

      const inlineFormat = (text) => {
        return text
          .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
          .replace(/`([^`]+)`/g, '<code>$1</code>');
      };

      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        const trimmed = line.trim();

        if (trimmed.startsWith('```')) {
          if (!inCode) {
            closeList();
            inCode = true;
            html += '<pre><code>';
          } else {
            inCode = false;
            html += '</code></pre>';
          }
          continue;
        }

        if (inCode) {
          html += escapeHtml(line) + '\n';
          continue;
        }

        if (trimmed === '') {
          closeList();
          continue;
        }

        if (trimmed === '---') {
          closeList();
          html += '<hr />';
          continue;
        }

        if (trimmed.startsWith('### ')) {
          closeList();
          html += `<h3>${inlineFormat(trimmed.slice(4))}</h3>`;
          continue;
        }

        if (trimmed.startsWith('## ')) {
          closeList();
          html += `<h2>${inlineFormat(trimmed.slice(3))}</h2>`;
          continue;
        }

        if (trimmed.startsWith('# ')) {
          closeList();
          html += `<h1>${inlineFormat(trimmed.slice(2))}</h1>`;
          continue;
        }

        const ulMatch = /^[-*]\s+(.+)/.exec(trimmed);
        if (ulMatch) {
          if (listType !== 'ul') {
            closeList();
            listType = 'ul';
            html += '<ul>';
          }
          html += `<li>${inlineFormat(ulMatch[1])}</li>`;
          continue;
        }

        const olMatch = /^\d+\.\s+(.+)/.exec(trimmed);
        if (olMatch) {
          if (listType !== 'ol') {
            closeList();
            listType = 'ol';
            html += '<ol>';
          }
          html += `<li>${inlineFormat(olMatch[1])}</li>`;
          continue;
        }

        closeList();
        html += `<p>${inlineFormat(trimmed)}</p>`;
      }

      closeList();
      return html;
    };

    const readme = document.getElementById('readme-md').textContent.trim();
    const manual = document.getElementById('manual-md').textContent.trim();

    document.getElementById('readme-content').innerHTML = renderMarkdown(readme);
    document.getElementById('manual-content').innerHTML = renderMarkdown(manual);
  </script>
</body>
</html>
